"use strict";(self.webpackChunkast_block_templates=self.webpackChunkast_block_templates||[]).push([[7],{5007:function(e,t,s){s.r(t),s.d(t,{default:function(){return A}});var o=s(7363),r=s(6048),a=s(5868),n=s(4142),l=s(9148),c=s(6128),i=s(1569),p=s(5622),m=o.forwardRef((function({title:e,titleId:t,...s},r){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true",ref:r,"aria-labelledby":t},s),e?o.createElement("title",{id:t},e):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}));const{compose:u}=wp.compose,{useSelect:d,withSelect:g,withDispatch:f}=wp.data,{post:b}=wp.ajax,{parse:h}=wp.blocks,{useState:y,memo:k}=wp.element;var v=u(g((e=>{const{getImportItemInfo:t,getCurrentScreen:s,getSitePreview:o,getActivePaletteSlug:r}=e("ast-block-templates");return{importItemInfo:t(),sitePreview:o(),currentScreen:s(),activePaletteSlug:r()}})),f((e=>{const{setImportItemInfo:t,setFullWidthBlockPreview:s,setCurrentScreen:o,setTogglePopup:r,setFullWidthPreview:a}=e("ast-block-templates"),{insertBlocks:n}=e("core/block-editor");return{setImportItemInfo:t,onSetTogglePopup:r,insertBlocks:n}})))(k((e=>{let{setImportItemInfo:t,liveRequest:s,requiredPlugins:o,importItemInfo:u,title:g,btnClass:f,currentScreen:k,insertBlocks:v,onSetTogglePopup:_,item:w,onClick:I,onBlockImport:E,activePaletteSlug:x}=e,[B,C]=y(u),S=o||[];const P=f||"",[R,j]=y(g||"Import"),[N,F]=y(!1),{insertIndex:$}=d((e=>{const{index:t}=e("core/block-editor").getBlockInsertionPoint();return{insertIndex:t}}),[]),A=()=>{(0,l.j)({slug:"ultimate-addons-for-gutenberg",init:"ultimate-addons-for-gutenberg/ultimate-addons-for-gutenberg.php",name:"Spectra"}).then((e=>{})).catch((e=>{F(!1),j("Activation failed!")}))},O=()=>{(0,l.j)({slug:"wpforms-lite",init:"wpforms-lite/wpforms.php",name:"WPForms Lite"}).then((e=>{q()})).catch((e=>{F(!1),j("Activation failed!")}))},L=()=>{const e=B.original_content,t=B["blocks-category"][0];b({action:"ast_block_templates_import_block",content:e,category:t,_ajax_nonce:ast_block_template_vars._ajax_nonce,style:x}).done((e=>{F(!1);const t=(0,r.CN)(h(e));v(t,$,"",!1),_(),document.getElementById("ast-block-templates-modal-wrap").classList.remove("open"),document.body.classList.remove("ast-block-templates-modal-open"),"function"==typeof E&&E(e,$),"active"!==ast_block_template_vars.spectra_status&&(0,p.iP)()})).fail((e=>{}))},q=()=>{B?.["post-meta"]?.["astra-site-wpforms-path"]||""?b({action:"ast_block_templates_import_wpforms",id:B.id,_ajax_nonce:ast_block_template_vars._ajax_nonce}).done((e=>{L()})).fail((e=>{F(!1),j("WPForms import failed!")})):L()};return React.createElement(a.Z,{className:(0,r.AK)("min-w-[7rem] hover:shadow-small sp-text-sm",P),type:"button",variant:"primary",onClick:e=>{"function"==typeof I&&I(e),F(!0),"not-installed"===ast_block_template_vars.spectra_status?(0,l.H)({slug:"ultimate-addons-for-gutenberg",init:"ultimate-addons-for-gutenberg/ultimate-addons-for-gutenberg.php",name:"Spectra"}).then((e=>{A()})).catch((e=>{F(!1),j("Installation failed!")})):"inactive"===ast_block_template_vars.spectra_status&&A(),(0,i.I)(w.ID,"astra-blocks").then((e=>{t(e),B=e,S=e?.["post-meta"]?.["astra-blocks-required-plugins"]?c.t.parse(e["post-meta"]["astra-blocks-required-plugins"]):[],S.length?"not-installed"===ast_block_template_vars.wpforms_status?(0,l.H)({slug:"wpforms-lite",init:"wpforms-lite/wpforms.php",name:"WPForms Lite"}).then((e=>{O()})).catch((e=>{F(!1),j("Installation failed!")})):"inactive"===ast_block_template_vars.wpforms_status?O():q():q()})).catch((e=>{}))},isSmall:!0,hasPrefixIcon:!N},N?React.createElement(n.Z,{className:"h-[1.3rem] w-[1.3rem] !shrink-0"}):React.createElement(React.Fragment,null,React.createElement(m,{className:"h-[1.3rem] w-[1.3rem] !shrink-0"}),R))}))),_=o.forwardRef((function({title:e,titleId:t,...s},r){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true",ref:r,"aria-labelledby":t},s),e?o.createElement("title",{id:t},e):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"}))})),w=s(10),I=s(6486);function E(){return E=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o])}return e},E.apply(this,arguments)}const{useEffect:x,useState:B}=wp.element,{site_url:C}=ast_block_template_vars,{compose:S}=wp.compose,{withDispatch:P,withSelect:R,useSelect:j}=wp.data;var N=S(R((e=>{const{getFilterBlocksByCategory:t,getFilterBlocksPagesByCategory:s}=e("ast-block-templates");return{filterBlocksByCategory:t(),filterBlocksPagesByCategory:s()}})),P((e=>{const{setFavorites:t,setFilterBlocksByCategory:s,setFilterBlocksPagesByCategory:o}=e("ast-block-templates");return{setFavorites:t,setFilterBlocksByCategory:s,setFilterBlocksPagesByCategory:o}})))((e=>{let{item:t,className:s,setFavorites:o,setFilterBlocksByCategory:a,filterBlocksByCategory:n,filterBlocksPagesByCategory:l,setFilterBlocksPagesByCategory:c,...i}=e;const[p,m]=B(!1),{favorites:u}=j((e=>{const{getFavorites:t}=e("ast-block-templates");return{favorites:t()}}));return x((()=>{const e=u&&u[t.type]?Object.values(u[t.type]):[];u&&e&&e.includes((0,I.parseInt)(t.ID))&&m(!0)}),[p]),React.createElement("button",E({className:(0,r.AK)("flex items-center justify-center rounded-full p-2 bg-white cursor-pointer border-0 focus:outline-none",p?"":"text-icon-secondary",s),onClick:async e=>{e?.preventDefault(),e?.stopPropagation();try{await(0,w.Z)({path:`${C}/wp-json/gutenberg-templates/v1/favorite`,data:{type:t.type,block_id:t.ID,status:!p},method:"POST",headers:{"X-WP-Nonce":ast_block_template_vars.rest_api_nonce,"content-type":"application/json"}})}catch(e){console.error(e)}let s={};const r=t.type;if(p){const e=Object.keys(u[r]).find((e=>u[r][e]===(0,I.parseInt)(t.ID)));e&&delete u[r][e],s={...u}}else{const e=Object.keys(u[r]).length>0?Math.max(...Object.keys(u[r]).map(Number))+1:0;u[r][e]=(0,I.parseInt)(t.ID),s={...u}}m(!p),o(s),"block"===r?a(n):c(l)}},i),React.createElement(_,{className:(0,r.AK)("w-6 h-6 transition-colors ease-out duration-150",p?"fill-favorite text-favorite":"hover:fill-favorite hover:text-favorite")}))}));const F=e=>{const t=["skip","logo","fav-icon"];for(const s of t)if(e.includes(s))return!0;return!1},{spectra_common_styles:$}=ast_block_template_vars;var A=e=>{let{item:t,content:s,stylesheet:a,astraCustomizer:n,globalStylesheet:l,colorPalette:c,dynamicContent:i,selectedImages:p,email:m,phone:u,address:d}=e;const g=(0,o.useRef)(null),f=(0,o.useRef)(null),b=t["thumbnail-image-url"]||"",h=t["featured-image-url"]||"";let y=0,k=0;const[_,w]=(0,o.useState)({importing:!1}),[I,E]=(0,o.useState)(`${ast_block_template_vars.uri}dist/placeholder_200_200.png`),[x,B]=(0,o.useState)(`${ast_block_template_vars.uri}dist/placeholder_200_200.png`);function C(){const e=g?.current,t=f?.current;if(!e||!t)return;const s=e.parentNode.offsetWidth/1200,o=s*t.offsetHeight;e.style.transform=`scale(${s})`,e.style.height=`${o}px`}return(0,o.useEffect)((()=>{let e=!0;const o={landscape:[],portrait:[]};p?.forEach((e=>{"landscape"===e.orientation?o.landscape.push(e):o.portrait.push(e)}));const r=o,g=new Image;g.src=b;const v=new Image;v.src=h;const _=f.current;function w(t,s){e&&(t.onload=()=>{s(t.src)})}w(g,E),w(v,B);const I=document.getElementById("astra-wp-editor-styles-inline-css")?.textContent.replace(/:root/g,".block-container").replace(/body/g,".block-container"),x=document.getElementById("astra-block-editor-styles-inline-css")?.textContent.replace(/:root/g,".block-container").replace(/body/g,".block-container");let S="";var P,R,j;if(a&&(P=a,R=r?.landscape,a=R&&0===R.length?P:P.replace(/background-image\s*:\s*url\(['"]?([^'")]+)['"]?\)/g,(function(e,t){if(F(t))return e;if(!R[y]?.url)return"";const s=R[y]?.url;return y++,'background-image: url("'+s+'")'}))),S+=n?`<style type="text/css" id="gt-astra-customizer">${n}</style>`:"",S+=`<style type="text/css" id="gt-spectra-common-stylesheet">${$}</style>`,S=a?`${S} <style type="text/css" id="gt-common-stylesheet">${a}</style>`:S,l&&(S+=`<style type="text/css" id="gt-global-stylesheet"> ${l} </style>`),I&&(S+=`<style type="text/css" id="gt-wpeditor-css" > ${I} </style>`),x&&(S+=`<style type="text/css" id="gt-blockeditor-css"> ${x} </style>`),_&&s){const e=_.attachShadow({mode:"open"});if(null===e)return;let o=s;const a=i?i[t.category]:[];a&&Object.keys(a)?.length>0&&Object.keys(a).forEach((e=>{o=null!==a[e]?o.replace(e,a[e]):o})),j=o,m&&(j=j.replace("contact@example.com",m)),u&&(j=j.replace("202-555-0188",u)),d&&(j=j.replace("2360 Hood Avenue, San Diego, CA, 92123",d)),o=j,e.innerHTML=S+o,c.forEach(((t,s)=>{e?.host.style.setProperty(`--ast-global-color-${s}`,t)}));const n=_.shadowRoot.querySelectorAll("div")[0];n?.classList.add("st-block-container");const l=_.shadowRoot.querySelectorAll("img");e&&(C(),((e,t)=>{const s=t.landscape?t.landscape:[],o=t.portrait?t.portrait:[];0!==s.length&&0!==o.length&&e?.forEach((function(e){F(e.src)||(e.onload=()=>{const t=(e=>{const t=new Image;return t.src=e,t.width>t.height?"landscape":"portrait"})(e.src);let r;if(r="landscape"===t?s[y]:o[k],void 0!==r&&(r.url.includes("unsplash")||r.url.includes("pexels")||r.url.includes("pixabay")))if("landscape"===t?y++:k++,"PICTURE"===e.parentNode.nodeName)e.parentNode.querySelectorAll("source").forEach((e=>{e.setAttribute("srcset",r.optimized_url)})),e.parentNode.querySelector("img").setAttribute("src",r.optimized_url);else{const t=document.createElement("img");t.src=r.optimized_url,e.parentNode.replaceChild(t,e)}})}))})(l,r))}return()=>{e=!1}}),[]),(0,o.useEffect)((()=>{const e=new ResizeObserver(C);return e.observe(document.documentElement),()=>{e&&e.disconnect()}}),[]),(0,o.useEffect)((()=>{const e=document.querySelector("#ast-block-templates-modal-wrap");if(!e)return;const t=new MutationObserver(C);return t.observe(e,{childList:!0,attributes:!0,subtree:!0}),()=>{t&&t.disconnect()}}),[]),(0,o.useEffect)((()=>{const e=f?.current;if(e){const t=e.shadowRoot;c.forEach(((e,s)=>{null!==t&&t.host.style.setProperty(`--ast-global-color-${s}`,e)}))}}),[c]),React.createElement("div",{className:(0,r.AK)("w-full h-fit p-5",!0===_.importing?"importing":"")},React.createElement("div",{className:"cursor-pointer relative border border-solid border-border-primary hover:border-accent-spectra transition duration-150 ease-in-out overflow-hidden group"},React.createElement("div",{className:"thumbnail left-0 m-0 min-h-[auto] overflow-visible text-left top-0 origin-top-left relative pointer-events-none",ref:g},React.createElement("div",{className:"absolute w-[1200px] pointer-events-none max-h-[1600px] overflow-hidden",ref:f},!s&&React.createElement("img",{srcSet:`${x}, ${I}`,src:I}),React.createElement("div",{className:"preview"},React.createElement("span",{className:"ast-block-templates-icon ast-block-templates-icon-search"})))),React.createElement("div",{className:"absolute inset-0 grid grid-cols-1 grid-rows-1 place-items-end"},React.createElement("div",{className:(0,r.AK)("opacity-0 group-hover:opacity-100 w-full flex items-center justify-between px-[20px] py-[14px] backdrop-blur-sm bg-white/[0.85] shadow-action-buttons transition-all duration-150 ease-in-out",!0===_.importing?"opacity-100":"")},React.createElement(v,{title:"Insert",liveRequest:!0,item:t,onClick:()=>{w({..._,importing:!0})},onBlockImport:()=>{w({..._,importing:!1})}}),React.createElement(N,{item:t})))))}}}]);
